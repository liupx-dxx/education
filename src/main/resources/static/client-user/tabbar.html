<!DOCTYPE html>
<html>
<head>
    <title>个人中心</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="../lib/weui.min.css">
    <link rel="stylesheet" href="../css/jquery-weui.css">
    <link rel="stylesheet" href="../css/demos.css">
    <!--<link rel="stylesheet" href="../css/reset.css"/>-->
    <link rel="stylesheet" href="../css/list.css"/>
</head>

<body ontouchstart>

<div class="weui-tab">
    <div class="weui-tab__bd weui-tab__panel ">
        <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
            <!-- 列表 -->
            <div id="remindList" style="padding-top: 0px"></div>
            <div id="reminLoading" hidden="hidden" style="font-size: 16px;color: #7a869d;text-align: center;padding-top: 20%"></div>
        </div>
        <div id="tab2" class="weui-tab__bd-item" >
            <div class="weui-search-bar" id="searchBar">
                <form class="weui-search-bar__form" action="#">
                    <div class="weui-search-bar__box">
                        <i class="weui-icon-search"></i>
                        <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索" required="">
<!--
                        <a href="javascript:" class="weui-icon-clear" id="searchClear"></a>
-->
                    </div>
                    <label class="weui-search-bar__label" id="searchText" style="transform-origin: 0px 0px 0px; opacity: 1; transform: scale(1, 1);">
                        <i class="weui-icon-search"></i>
                        <span>搜索</span>
                    </label>
                </form>
                <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
            </div>
            <!-- 列表 -->
            <div id="list" style="padding-top: 0px"></div>
            <div id="loading" hidden="hidden" style="font-size: 16px;color: #7a869d;text-align: center;padding-top: 20%"></div>
        </div>
        <div id="tab3" class="weui-tab__bd-item">
            <!--<div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/weichat/iconweixinpengyouquan.png" alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>朋友圈</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>

            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/weichat/saoyisao.png"  alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>扫一扫</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img  src="/images/weichat/share.png"     alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>摇一摇</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img  src="/images/weichat/Sercher.png"  alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>看一看</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img  src="/images/weichat/select.png"  alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>搜一搜</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>

            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img  src="/images/weichat/nearpeople.png"  alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>附近的人</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img  src="/images/weichat/floatcup.png"  alt="" style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>漂流瓶</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>

            </div>-->
        </div>
        <div id="tab4" class="weui-tab__bd-item">
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:70px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p style="color: #7a869d">用户名 &nbsp;: &nbsp;<span id="phone"></span></p>
                        <p style="color: #7a869d">剩余总课时 &nbsp;: &nbsp;&nbsp;<span id="surplus"></span></p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>小程序</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>收藏</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>相册</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>卡包</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>表情</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p>设置</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p id="login-switch" style="color: red">切换账号</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
            <div class="weui-cells">
                <a class="weui-cell weui-cell_access" href="javascript:;">
                    <div class="weui-cell__hd"><img src="/images/1.png" alt=""
                                                    style="width:20px;margin-right:5px;display:block"></div>
                    <div class="weui-cell__bd">
                        <p id="login-out" style="color: red">退出登录</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </a>
            </div>
        </div>
    </div>
    <div class="weui-tabbar" style="position: fixed">
        <a href="#tab1" class="weui-tabbar__item weui-bar__item--on" onclick="tipInfo()">
            <span class="weui-badge" id="dataNum" style="position: absolute;top: -.4em;right: 1em;"></span>
            <div class="weui-tabbar__icon">
                <img src="../images/icon_nav_button.png" alt="">
            </div>
            <p class="weui-tabbar__label" id="remindButton">最新消息</p>
        </a>

        <a href="#tab2" class="weui-tabbar__item" onclick="classListInfo()">
            <div class="weui-tabbar__icon">
                <img src="../images/icon_nav_msg.png" alt="">
            </div>
            <p class="weui-tabbar__label">课程列表</p>
        </a>
        <!--<a href="#tab3" class="weui-tabbar__item">
          <div class="weui-tabbar__icon">
            <img src="../images/icon_nav_article.png" alt="">
          </div>
          <p class="weui-tabbar__label">发现</p>
        </a>-->
        <a href="#tab4" class="weui-tabbar__item" onclick="myInfo()">
            <div class="weui-tabbar__icon">
                <img src="../images/icon_nav_cell.png" alt="">
            </div>
            <p class="weui-tabbar__label">我的</p>
        </a>
    </div>
</div>

<div id="cart" class='weui-popup__container popup-bottom'>
    <div class="weui-popup__overlay"></div>
    <div class="weui-popup__modal">
        <div class="toolbar">
            <div class="toolbar-inner" style="margin-bottom: 35px">
                <a href="javascript:;" class="picker-button close-popup">关闭</a>
                <input hidden="hidden" id="remindUserClassId">
                <h1 style="padding-top: 30px" class="title" id="className"></h1>
                <span style="font-size: 12px">上课时间 ：</span>
                <span id="classTime" style="font-size: 12px;color: #7a869d"></span>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <span style="font-size: 12px">剩余课时 ：</span>
                <span id="classHourNum" style="font-size: 12px;color: #7a869d"></span>
            </div>
        </div>
        <div class="modal-content" style="padding-top: 90px">
            <div class="weui-grids" id="remindDiv" style="padding-bottom: 70px">
                <a href="javascript:;" class="weui-btn weui-btn_primary" id="remindSign">签到</a>
                <a href="javascript:;" class="weui-btn weui-btn_primary" id="remindLeave">请假</a>
            </div>
        </div>
    </div>
</div>



<script src="../lib/jquery-2.1.4.js"></script>
<script src="../lib/fastclick.js"></script>
<script type="text/javascript" src="../js/detailList.js"></script>
<script src="../js/jquery-weui.js"></script>
<script>
    //记录当前在哪个标签下
    flag = 1;
    $("#a").select({
        title: "选择职业",
        items: ["法官", "医生", "猎人", "学生", "记者", "其他"]
    });
    //下拉刷新
    var userName = "user";

    var flag = true;
    $('#searchInput').on('compositionstart',function(){
        //中文状态下
        flag = false;
    })
    $('#searchInput').on('compositionend',function(){
        //英文状态下
        flag = true;
    })
    $('#searchInput').on('input',function(){
        setTimeout(function(){
            if(flag){
                var searchInput = $("#searchInput").val();
                $("#list").html("");
                new_getList(searchInput);
            }
        },0)
    })



    function search() {
        var searchInput = $("#searchInput").val();
        $("#list").html("");
        new_getList(searchInput);
    }

    //获取我的信息
    function myInfo() {
        flag = 3;
        $.ajax({
            url: "/client/getUserInfo",
            type: "post",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.code != '2000') {
                    $.toptip(data.msg);
                    return
                } else {
                    $("#phone").text(data.data.phone);
                    $("#surplus").text(data.data.surplus);
                }
            },
            error: function (e) {
                alert("错误！！");
            }
        });
    }

    //获取我的课程列表
    function classListInfo() {
        flag = 2;
        $("#list").html("");
        new_getList("");
    }

    //获取我的课程列表
    function tipInfo() {
        flag = 1;
        $("#remindList").html("");
        getReimdlist();
    }

    //获取个人信息
    $(function () {
        getReimdlist();
        $("#login-out").click(function () {
            $.confirm("您确定要退出吗?", "确认", function () {
                window.location.href = "/client/login-out";
            }, function () {
                //取消操作
            });
        })

        $("#login-switch").click(function () {
            $.confirm("您确定要切换账号吗?", "确认", function () {
                window.location.href = "/client/login-out";
            }, function () {
                //取消操作
            });
        })
        //提醒页面签到
        $("#remindSign").click(function () {
            var userClassId = $("#remindUserClassId").val();
            $.confirm("扣除2课时,您确定要签到吗?", "确认签到?", function () {
                $.ajax({
                    url: "/client/userClass/signIn/" + userClassId,
                    type: "get",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.code != '2000') {
                            $.toptip(data.msg);
                            return
                        } else {
                            $.toptip('签到成功', 'success');
                            //计算剩余课时
                            var classHourNum = $("#classHourNum").text();
                            var vlaue = eval(classHourNum-2);
                            $("#classHourNum").html(vlaue);
                            $("#remindDiv").html('<a href="javascript:;" class="weui-btn weui-btn_primary" disabled="true">今天以签到</a>');
                        }
                    },
                    error: function (e) {
                        alert("错误！！");
                    }
                });
            }, function () {
                //取消操作
            });
        })

        //提醒页面请假
        $("#remindLeave").click(function () {
            var userClassId = $("#remindUserClassId").val();
            $.confirm("您确定要请假吗?", "确认请假?", function () {
                $.ajax({
                    url: "/client/userClass/leave/" + userClassId,
                    type: "get",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.code != '2000') {
                            $.toptip(data.msg);
                            return
                        } else {
                            $.toptip('请假成功', 'success');
                            $("#remindDiv").html('<a href="javascript:;" class="weui-btn weui-btn_primary" disabled="true">今天以签到</a>');
                        }
                    },
                    error: function (e) {
                        alert("错误！！");
                    }
                });
            }, function () {
                //取消操作
            });
            });
        FastClick.attach(document.body);
        });
        var detailList = new h5Detail2list();
        var loading = false;
        var listnum = 0; //总加载条数
        var num = 25 //每次加载条数
        if ($.isEmptyObject(detailList.getLocalStorage()['extraData']) || !detailList.isBack()) {
            //初始化
            new_getList("");
        }
        listnum = $.isEmptyObject(detailList.getLocalStorage()['extraData']) ? listnum : detailList.getLocalStorage()[
            'extraData']['lastIndex'];


        function new_getList(param) {
            $.ajax({
                url: "/client/userClass/findAllById?param=" + param,
                type: "get",
                dataType: 'json',
                success: function (data) {
                    var dataObjiect = data.data;
                    var dataList = dataObjiect.userClassList;
                    userName = dataObjiect.phone;
                    var li = '';
                    var data_length = dataList.length; //数据的总条数
                    var remainder = data_length % num; //page 是每次加载的条数，利用数据的总条数/每次加载条数 取余数
                    if (data_length >= 0 && data_length != null) {
                        for (i = 0; i < data_length; i++) {
                            li
                                += '' +
                                '<div class="weui-form-preview">' +
                                '   <div class="weui-form-preview__hd">' +
                                '       <div class="weui-form-preview__item">' +
                                '       <label class="weui-form-preview__label">课程名称</label>' +
                                '       <em class="weui-form-preview__value">' + dataList[i]["className"] + '</em>' +
                                // '           <a herf="javascript:" style="font-size: 10px" onclick="discuss('+dataList[i]["id"]+')">进入讨论区>>></a>'+
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__bd">' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">课程类型</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["classType"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">购买金额</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["price"] + "" + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">上课时间</label>' +
                                '           <span class="weui-form-preview__value">' + '每' + dataList[i]["classTime"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">剩余课时</label>' +
                                '           <span class="weui-form-preview__value" style="font-size: 24px">' + dataList[i]["classHourNum"] + '</span>' +
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__ft">';
                            var signInFlag = dataList[i]["signInFlag"];
                            if ("1" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已签到</a>';
                            } else if ("2" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已请假</a>';

                            } else {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="leave(' + dataList[i]["id"] + ',this' + ')">请假</a>' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="sign(' + dataList[i]["id"] + ',this' + ')">签到</a>';
                            }
                            li
                                += '' +
                                '   </div>' +
                                '</div>';
                        }
                        $("#list").append(li);
                    } else {
                        $('#loading').html("您还没有购买的课程哦~~~");
                        $('#loading').show();
                    }
                },
                error: function () {
                    console.log("出错了");
                }
            });
        }

        //模拟ajax数据请求
        function getList() {
            $.ajax({
                url: "/client/userClass/findAllById",
                type: "get",
                dataType: 'json',
                success: function (data) {
                    var dataObjiect = data.data;
                    var dataList = dataObjiect.userClassList;
                    userName = dataObjiect.phone;
                    var li = '';
                    var data_length = dataList.length; //数据的总条数
                    var remainder = data_length % num; //page 是每次加载的条数，利用数据的总条数/每次加载条数 取余数
                    if (listnum <= data_length && dataList.length >= (num + listnum)) {
                        loading = true
                        for (i = listnum; i < (num + listnum); i++) {
                            li
                                += '' +
                                '<div class="weui-form-preview">' +
                                '   <div class="weui-form-preview__hd">' +
                                '       <div class="weui-form-preview__item">' +
                                '       <label class="weui-form-preview__label">课程名称</label>' +
                                '       <em class="weui-form-preview__value">' + dataList[i]["className"] + '</em>' +
                                // '           <a herf="javascript:" style="font-size: 10px" onclick="discuss('+dataList[i]["id"]+')">进入讨论区>>></a>'+
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__bd">' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">课程类型</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["classType"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">购买金额</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["price"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">上课时间</label>' +
                                '           <span class="weui-form-preview__value">' + '每' + dataList[i]["classTime"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">剩余课时</label>' +
                                '           <span class="weui-form-preview__value" style="font-size: 24px">' + dataList[i]["classHourNum"] + '</span>' +
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__ft">';
                            var signInFlag = dataList[i]["signInFlag"];
                            if ("1" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已签到</a>';
                            } else if ("2" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已请假</a>';

                            } else {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="leave(' + dataList[i]["id"] + ')">请假</a>' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="sign(' + dataList[i]["id"] + ')">签到</a>';
                            }
                            li
                                += '' +
                                '   </div>' +
                                '</div>';
                        }
                        $("#list").append(li);
                        listnum += num;

                    } else if (remainder != 0 && data_length - listnum == remainder) {
                        loading = true
                        for (i = listnum; i < (remainder + listnum); i++) {
                            li
                                += '' +
                                '<div class="weui-form-preview">' +
                                '   <div class="weui-form-preview__hd">' +
                                '       <div class="weui-form-preview__item">' +
                                '       <label class="weui-form-preview__label">课程名称</label>' +
                                '       <em class="weui-form-preview__value">' + dataList[i]["className"] + '</em>' +
                                // '           <a herf="javascript:" style="font-size: 10px" onclick="discuss('+dataList[i]["id"]+')">进入讨论区>>></a>'+
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__bd">' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">课程类型</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["classType"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">购买金额</label>' +
                                '           <span class="weui-form-preview__value">' + dataList[i]["price"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">上课时间</label>' +
                                '           <span class="weui-form-preview__value">' + '每' + dataList[i]["classTime"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">剩余课时</label>' +
                                '           <span class="weui-form-preview__value" style="font-size: 24px">' + dataList[i]["classHourNum"] + '</span>' +
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__ft">';
                            var signInFlag = dataList[i]["signInFlag"];
                            if ("1" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已签到</a>';
                            } else if ("2" === signInFlag) {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已请假</a>';

                            } else {
                                li
                                    += '' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="leave(' + dataList[i]["id"] + ')">请假</a>' +
                                    '       <a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" onclick="sign(' + dataList[i]["id"] + ')">签到</a>';
                            }
                            li
                                += '' +
                                '   </div>' +
                                '</div>';
                        }
                        $("#list").append(li);
                        listnum += num;
                    } else {
                        loading = false
                        $('#loading').html("没有更多了哦~");
                    }
                },
                error: function () {
                    console.log("出错了");
                }
            });
        }

        function sign(id, dataVla) {

            $.confirm("扣除2课时,您确定要签到吗?", "确认签到?", function () {
                $.ajax({
                    url: "/client/userClass/signIn/" + id,
                    type: "get",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.code != '2000') {
                            $.toptip(data.msg);
                            return
                        } else {
                            $.toptip('签到成功', 'success');
                            //$("#tab2").addClass('weui-tab__bd-item--active').siblings('.weui-tab__bd-item').removeClass('weui-tab__bd-item--active');
                            //window.location.href = "/client/to-personal";
                            $(dataVla).parent().html('<a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已签到</a>');
                        }
                    },
                    error: function (e) {
                        alert("错误！！");
                    }
                });
            }, function () {
                //取消操作
            });

        }

        //请假
        function leave(id, dataVla) {

            $.confirm("您确定要请假吗?", "确认请假?", function () {
                $.ajax({
                    url: "/client/userClass/leave/" + id,
                    type: "get",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.code != '2000') {
                            $.toptip(data.msg);
                            return
                        } else {
                            $.toptip('请假成功', 'success');
                            $(dataVla).parent().html('<a class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:" style="color: gray" disabled="disabled">该课程今天您已请假</a>');
                        }
                    },
                    error: function (e) {
                        alert("错误！！");
                    }
                });
            }, function () {
                //取消操作
            });

        }
        //模拟ajax数据请求
        function getReimdlist() {
            $.ajax({
                url: "/client/signInRemind/findAllById",
                type: "get",
                dataType: 'json',
                success: function (data) {
                    var noReadNum = data.data.noReadNum;
                    if (noReadNum <= 0) {
                        $("#dataNum").hide();
                    } else {
                        $("#dataNum").text(noReadNum);
                    }
                    var dataArray = data.data.remindList;
                    var li = '';
                    var data_length = dataArray.length; //数据的总条数
                    if (dataArray != null && data_length > 0) {
                        loading = true
                        for (var i = 0; i < data_length; i++) {
                            var remingId = dataArray[i]["id"];
                            var userClassId = dataArray[i]["userClassId"];
                            var className = dataArray[i]["className"];
                            var classTime = dataArray[i]["classTime"];
                            var classHourNum = dataArray[i]["classHourNum"];
                            li
                                += '' +
                                '<div class="weui-form-preview">';
                            var readState = dataArray[i]["readState"]
                            if (readState === "0") {
                                li
                                    += '' +
                                    '   <span class="weui-badge" style="position: absolute;right: 1em;">1</span>';
                            }
                            li
                                += '' +
                                '   <div class="weui-form-preview__ft">' +
                                '       <span class="weui-form-preview__btn weui-form-preview__btn_primary" style="color: #7a869d;font-size: 8px" href="javascript:">' + dataArray[i]["createTime"] + '</span>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__hd">' +
                                '       <div class="weui-form-preview__item">' +
                                '       <label class="weui-form-preview__label">课程名称</label>' +
                                '       <em class="weui-form-preview__value">' + dataArray[i]["className"] + '</em>' +
                                // '           <a herf="javascript:" style="font-size: 10px" onclick="discuss('+dataList[i]["id"]+')">进入讨论区>>></a>'+
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__bd">' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">课程类型</label>' +
                                '           <span class="weui-form-preview__value">' + dataArray[i]["classType"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">老师姓名</label>' +
                                '           <span class="weui-form-preview__value">' + dataArray[i]["teacherName"] + '</span>' +
                                '       </div>' +
                                '       <div class="weui-form-preview__item">' +
                                '           <label class="weui-form-preview__label">上课时间</label>' +
                                '           <span class="weui-form-preview__value">' + '每' + dataArray[i]["classTime"] + '</span>' +
                                '       </div>' +
                                '   </div>' +
                                '   <div class="weui-form-preview__ft">' +
                                '       <a class="weui-form-preview__btn weui-form-preview__btn_primary open-popup" onclick="to_sign('+remingId+ ',' + userClassId+ ',this' + ','+readState+')" data-target="#cart" href="javascript:">查看详情</a>' +
                                '   </div>' +
                                '</div>';
                        }
                        $("#remindList").append(li);
                    } else {
                        $("#reminLoading").html("您还没有要提醒的课程哦~~~")
                        $("#reminLoading").show();
                    }
                },
                error: function () {
                    console.log("出错了");
                }
            });
        }


        function to_sign(remindId,userClassId,remindThis,readState) {
            //清楚小红点
            if(readState === 0){
                $(remindThis).parent().siblings(".weui-badge").hide();
                var dataNum = $("#dataNum").text();
                if(dataNum != "0"){
                    $("#dataNum").html(eval(dataNum-1));
                }
                $.ajax({
                    url: "/client/signInRemind/remindAlreadySee/" + remindId,
                    type: "get",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                    },
                    error: function (e) {
                        alert("错误！！");
                    }

                });
            }
            //获取课程信息
            $.ajax({
                url: "/client/userClass/findById/" + userClassId,
                type: "get",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#className").html(data.className);
                    $("#classTime").html(data.classTime);
                    $("#classHourNum").html(data.classHourNum);
                    $("#remindUserClassId").val(data.id);
                    var signInFlag = data.signInFlag;
                    if (signInFlag === "1") {
                        //已签到
                        $("#remindDiv").html('<a href="javascript:;" class="weui-btn weui-btn_primary" disabled="true">今天以签到</a>');
                    } else if (signInFlag === "2") {
                        //已请假
                        $("#remindDiv").html('<a href="javascript:;" class="weui-btn weui-btn_primary" disabled="true">今天以请假</a>');
                    }

                },
                error: function (e) {
                    alert("错误！！");
                }
            });
        }

</script>
</body>
</html>
